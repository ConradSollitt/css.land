<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>LCH Colour picker</title>
	<link rel="stylesheet" href="style.css">
	<script src="https://dev.mavo.io/dist/mavo.es5.js"></script>
	<script src="https://drafts.csswg.org/css-color-4/math.js"></script>
	<script src="https://drafts.csswg.org/css-color-4/conversions.js"></script>
	<script src="https://drafts.csswg.org/css-color-4/utilities.js"></script>
</head>
<body>
	<main mv-storage="local" mv-app="color-picker" mv-autosave="0" class="[if(!isLCH_within_sRGB(lightness, chroma, hue), 'out-of-gamut')]" style="--color: [colorRGB]">
	<h1>LCH Colour Picker</h1>

	<label>Lightness (0-100)
		<input type="range" property="lightness"
		       style="background-image: linear-gradient(to right, [slider_stops(range(0, 100, 50), -1, chroma, hue, 0)])" />
	</label>
	<label>Chroma (0-132)
		<input type="range" property="chroma"
		       style="background-image: linear-gradient(to right, [slider_stops(range(0, 132, 132 / 5), lightness, -1, hue, 1)])" max="132" />
	</label>
	<label>Hue (0-360)
		<input type="range" property="hue" max="360"
		       style="background-image: linear-gradient(to right,
						  [slider_stops(range(0, 360, 30), lightness, chroma, -1, 2)]
			    )" />
	</label>
	<label>CSS Color
		<input property="color" value="lch([lightness]%, [chroma], [hue])" readonly />
	</label>
	<label><abbr>sRGB</abbr> Color
		<input property="colorRGB" value="[LCH_to_sRGB_string(lightness, chroma, hue)]" readonly />
		<div class="out-of-gamut-warning">Out of sRGB gamut, displaying [LCH_to_sRGB_string_clipped(lightness, chroma, hue)]</div>
	</label>
	<label>P3 Color
		<input property="colorP3" value="[LCH_to_sRGB_string(lightness, chroma, hue)]" readonly />
		<div class="out-of-gamut-warning">Out of P3 gamut, displaying [LCH_to_sRGB_string_clipped(lightness, chroma, hue)]</div>
	</label>
	<footer>
		Made by <a href="http://lea.verou.me" target="_blank">Lea Verou</a> with <a href="https://mavo.io" target="_blank">Mavo</a>. Conversion logic by <a href="https://svgees.us" target="_blank">Chris Lilley</a>.
	</footer>
</main>

<script>
function LCH_to_sRGB_string(l, c, h) {
	return "rgb(" + LCH_to_sRGB([+l, +c, +h]).map(x => {
		x = Math.round(x * 10000)/100;
		return x + "%";
	}).join(", ") + ")"
}
function LCH_to_sRGB_string_clipped(l, c, h) {
	return "rgb(" + LCH_to_sRGB([+l, +c, +h]).map(x => {
		x = Math.round(x * 10000)/100;
		x = Math.min(100, Math.max(0, x));
		return x + "%";
	}).join(", ") + ")"
}

function isLCH_within_sRGB(l, c, h) {
	var rgb = LCH_to_sRGB([+l, +c, +h]);
	return rgb.reduce((a, b) => a && b >= 0 && b <= 1, true);
}

function slider_stops(range, l, c, h, index) {
	return range.map(x => {
		args = [l, c, h];
		args[index] = x;
		return LCH_to_sRGB_string(...args);
	}).join(", ")
}
</script>
</body>
</html>
